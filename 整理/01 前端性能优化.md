# 前端性能优化

1. 尽量合并和压缩`css`和`js`文件。

   - 原因：可以减少http请求次数以及减少请求资源的大小

2. 尽量使用字体图标或者SVG图标来代替传统图片

   - 原因：字体图标和SVG图标是矢量图，渲染速度快，且放大不会变形

3. 能用`css`做的效果不用`js`做，能用原生`js`做的不轻易使用第三方库

4. 采用图片懒加载（延迟加载）

   目的：减少页面第一次加载 过程中http请求次数

   具体步骤：

   - 通过dataset来自定义属性`data-src`(这个可以自定义),`<img data-src="./1.jpg" alt="">`，获取这个属性的值时使用`var dataSrc = today.dataset.src;`

   - 页面中的`img`元素，如果没有`src`属性，浏览器就不会发起请求去下载图片，只有设置了路径才能请求。懒加载的基本原理就是使用`dataset`自定义属性取代`src`存储图片的路径，然后等到页面其他部分加载完成后再将其换为`src`。

     - 图片：`<img data-src="./1.jpg" alt="">`

     -  替换`src`：

       ```javascript
       getInfo() { 
           /*  在这里加载页面其余信息  */
       }.then() {
           /* 在这里将图片的src属性赋值为data-src的值*/
         let img = document.querySelectorAll("img");
         for(let i=0; i<img.length; i++) {
           img[i].src = img[i].dataset.src;
         }  
       }
       ```

   - 占位符：这样的基本懒加载已经完成，但是用户体验效果还是不太好，我们通常会使用一张占位符来显示该区域有图片即将加载出来的样子(`loading.gif`)。先将所有的图片的`src`设置为占位图标，然后加载完其余信息后将`src`再替换为`data-src`中的值。

     - 图片：`<img data-src="./1.jpg" src="./loading.gif" alt="">`

     - 替换`src`：

       ```javascript
       getInfo() { 
           /*  在这里加载页面其余信息  */
       }.then() {
           /* 在这里将图片的src属性赋值为data-src的值*/
         let img = document.querySelectorAll("img");
         for(let i=0; i<img.length; i++) {
           img[i].src = img[i].dataset.src;
         }  
       }
       ```

5. 在客户端和服务端进行数据通信的时候，尽量采用json格式进行数据传输

   - `json`格式的数据更加轻量级
   - `json`格式数据，展示数据清晰明了

6. 采用CDN（内容分发网络）加速

   - 用户获取数据时，不需要直接从源站获取，通过CDN对于数据的分发，选择一个更优（距离近，稳定）的服务器获取数据，从而提高用户访问系统的响应时间，并且能减轻源站负载压力

7. 尽量减少对DOM的操作

   - 页面中的DOM结构改变或者样式改变，会触发浏览器的回流和重绘

8. 更多的使用异步编码

   - 同步编码会导致堵塞

9. CSS选择器优化（几乎可忽略）

   - 尽量减少标签选择器的使用
   - 尽量少使用id选择器，多实用样式类选择器
   - 减少选择器前面的前缀

#### 10.前端性能优化之缓存

- 缓存的种类
  - CDN缓存
  - DNS缓存
  - 客户端缓存
- CDN缓存
  - CDN可以理解为分布在每个县城的火车票代售点，我们买火车票的时候就不用去花费时间精力去火车站购买票，只需要选择离自己最近的代售点购买就行。
  - 浏览器会选择一个离自己最近的CDN节点来响应请求。
  - 优点：提高用户访问系统的响应时间，并且能减轻源站负载压力
- DNS缓存
  - DNS查找流程：首先看浏览器缓存是否存在，不存在则访问本机DNS缓存，再不存在则访问本地DNS服务器。
  - DNS缓存是指在某个存活时间内查找到的DNS缓存记录，但是时间相对较短，比如Chrome只有1分钟左右。
  - DNS缓存就是在某个存活时间内，所访问的资源是保存在本机DNS缓存中的，如果在存活时间内，再次访问该资源，就直接从本机DNS缓存中可以获取到。
- 客户端缓存
  1. `Cache-control:max-age`（强缓存）
     - 假设有个脚本文件被频繁使用，且长时间不需要更新。我们就会希望浏览器把这个脚本缓存起来，不要每一次都请求服务器。
     - 可以通过设置文件返回的HTTP头中的`Cache-control:max-age`来设置它的缓存时间(最长为1年)
     - `Cache-Control: max-age=31536000`
  2. Storage存储机制（存储空间大，用法简单，方便存储服务器或本地的一些临时数据）
     - `sessionStorage`：用来存储与页面相关的数据，在页面关闭后无法使用。
     - `localStorage`：在页面关闭后也存在。



缓存的优点：

- 减少了不必要的数据传输，节省带宽
- 减少服务器的负担，提升网站性能
- 加快了客户端加载网页的速度
- 用户体验友好

强缓存和协商缓存的区别：

|          | 获取资源形式 | 状态码 | 发送请求到服务器                 |
| :------- | :----------- | ------ | -------------------------------- |
| 强缓存   | 从缓存取     | 200    | 否，直接从缓存中取               |
| 协商缓存 | 从缓存取     | 304    | 是，通过服务器来告知缓存是否可用 |

















